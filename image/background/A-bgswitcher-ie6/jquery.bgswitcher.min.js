/*!
 * jQuery.BgSwitcher
 *
 * @version  0.4.3
 * @author   rewish <rewish.org@gmail.com>
 * @license  MIT License (https://github.com/rewish/jquery-bgswitcher/blob/master/LICENSE.md)
 * @link     https://github.com/rewish/jquery-bgswitcher
 */(function(b){function d(a){this.$el=b(a);this.index=0;this.config=b.extend({},d.defaultConfig);this._setupBackgroundElement();this._listenToResize()}var f={},k=Array.prototype.slice,l=Object.prototype.toString,g=["Top","Right","Bottom","Left"],h="Attachment Color Image Repeat Position Size Clip Origin".split(" ");b.fn.bgswitcher=function(){var a=arguments,e=d.keys.instance;return this.each(function(){var c=b.data(this,e);c||(c=new d(this),b.data(this,e,c));c.dispatch.apply(c,a)})};b.fn.bgSwitcher=b.fn.bgswitcher;b.extend(d.prototype,{dispatch:function(a){switch(l.call(a)){case "[object Object]":this.setConfig(a);break;case "[object String]":this[a].apply(this,k.call(arguments,1));break;default:throw Error("Please specify a Object or String");}},setConfig:function(a){this.config=b.extend(this.config,a);"undefined"!==typeof this.config.random&&(this.config.shuffle=this.config.random);this.refresh()},setImages:function(a){this.imageList=new this.constructor.ImageList(a);this.config.shuffle&&this.imageList.shuffle()},setSwitchHandler:function(a){this.switchHandler=b.proxy(a,this)},getBuiltInSwitchHandler:function(a){return this.constructor.switchHandlers[a||this.config.effect]},refresh:function(){this.setImages(this.config.images);this.setSwitchHandler(this.getBuiltInSwitchHandler());this._prepareSwitching();this.config.start&&this.start()},start:function(){this._timerID||(this._timerID=setTimeout(b.proxy(this,"next"),this.config.interval))},stop:function(){this._timerID&&(clearTimeout(this._timerID),this._timerID=null)},toggle:function(){this._timerID?this.stop():this.start()},reset:function(){this.index=0;this._prepareSwitching()},next:function(){var a=this.imageList.count();if(this.config.loop||this.index+1!==a)++this.index===a&&(this.index=0),this.switching()},prev:function(){if(this.config.loop||0!==this.index)-1===--this.index&&(this.index=this.imageList.count()-1),this.switching()},select:function(a){-1===a&&(a=this.imageList.count()-1);this.index=a;this.switching()},switching:function(){var a=!!this._timerID;a&&this.stop();this._createSwitchableElement();this._prepareSwitching();this.switchHandler(this.$switchable);a&&this.start()},destroy:function(){this.stop();this._stopListeningToResize();this.$switchable&&(this.$switchable.stop(),this.$switchable.remove(),this.$switchable=null);this.$bg&&(this.$bg.remove(),this.$bg=null);this.$el.removeAttr("style");this.$el.removeData(this.constructor.keys.instance);this.$el=null},_adjustRectangle:function(){var a,e=0,c=g.length;a=this.$el.position();for(var b={top:a.top,left:a.left,width:this.$el.innerWidth(),height:this.$el.innerHeight()};e<c;e++)a=g[e],b["margin"+a]=this.$el.css("margin"+a),b["border"+a]=this.$el.css("border"+a);this.$bg.css(b)},_setupBackgroundElement:function(){this.$bg=b(document.createElement("div"));this.$bg.css({position:"absolute",zIndex:(parseInt(this.$el.css("zIndex"),10)||0)-1,overflow:"hidden"});this._copyBackgroundStyles();this._adjustRectangle();"BODY"===this.$el[0].tagName?this.$el.prepend(this.$bg):(this.$el.before(this.$bg),this.$el.css("background","none"))},_createSwitchableElement:function(){this.$switchable&&this.$switchable.remove();this.$switchable=this.$bg.clone();this.$switchable.css({top:0,left:0,margin:0,border:"none"});this.$switchable.appendTo(this.$bg)},_copyBackgroundStyles:function(){for(var a,b={},c=0,d=h.length;c<d;c++)a="background"+h[c],b[a]=this.$el.css(a);void 0===b.backgroundPosition&&(b.backgroundPosition=[this.$el.css("backgroundPositionX"),this.$el.css("backgroundPositionY")].join(" "));this.$bg.css(b)},_listenToResize:function(){var a=this;this._resizeHandler=function(){a._adjustRectangle()};b(window).on("resize",this._resizeHandler)},_stopListeningToResize:function(){b(window).off("resize",this._resizeHandler);this._resizeHandler=null},_prepareSwitching:function(){this.$bg.css("backgroundImage",this.imageList.url(this.index))}});d.keys={instance:"bgSwitcher"};d.defaultConfig={images:[],interval:5E3,start:!0,loop:!0,shuffle:!1,effect:"fade",duration:1E3,easing:"swing"};d.switchHandlers={fade:function(a){a.animate({opacity:0},this.config.duration,this.config.easing)},blind:function(a){a.animate({height:0},this.config.duration,this.config.easing)},clip:function(a){a.animate({top:parseInt(a.css("top"),10)+a.height()/2,height:0},this.config.duration,this.config.easing)},slide:function(a){a.animate({top:-a.height()},this.config.duration,this.config.easing)},drop:function(a){a.animate({left:-a.width(),opacity:0},this.config.duration,this.config.easing)},hide:function(a){a.hide()}};d.defineEffect=function(a,b){this.switchHandlers[a]=b};d.ImageList=function(a){this.images=a;this.createImagesBySequence();this.preload()};b.extend(d.ImageList.prototype,{isSequenceable:function(){return"string"===typeof this.images[0]&&"number"===typeof this.images[1]&&"number"===typeof this.images[2]},createImagesBySequence:function(){if(this.isSequenceable()){var a=[],b=this.images[0],c=this.images[1],d=this.images[2];do a.push(b.replace(/\.\w+$/,c+"$\x26"));while(++c<=d);this.images=a}},preload:function(){for(var a,b=this.images.length,c=0;c<b;c++)a=this.images[c],f[a]||(f[a]=new Image,f[a].src=a)},shuffle:function(){var a,b,c=this.images.length,d=this.images.join();if(c){for(;c;)a=Math.floor(Math.random()*c),b=this.images[--c],this.images[c]=this.images[a],this.images[a]=b;this.images.join()===d&&this.shuffle()}},get:function(a){return this.images[a]},url:function(a){return"url("+this.get(a)+")"},count:function(){return this.images.length}});b.BgSwitcher=d})(jQuery);